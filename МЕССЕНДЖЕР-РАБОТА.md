# üöÄ –ú–ï–°–°–ï–ù–î–ñ–ï–† - –ü–û–õ–ù–ê–Ø –†–ê–ë–û–¢–ê

*–í—Å–µ –∫–æ–¥—ã, –∫–æ–º–∞–Ω–¥—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ*

---

## üì± –ì–û–¢–û–í–´–ï –ö–û–î–´ –ú–ï–°–°–ï–ù–î–ñ–ï–†–ê

### üéØ App.js - –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```javascript
import React from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { createStackNavigator } from '@react-navigation/stack';
import LoginScreen from './screens/LoginScreen';
import ChatScreen from './screens/ChatScreen';

const Stack = createStackNavigator();

export default function App() {
  return (
    <NavigationContainer>
      <Stack.Navigator 
        initialRouteName="Login"
        screenOptions={{
          headerStyle: { backgroundColor: '#2196F3' },
          headerTintColor: '#fff',
          headerTitleStyle: { fontWeight: 'bold' },
        }}
      >
        <Stack.Screen 
          name="Login" 
          component={LoginScreen}
          options={{ title: '–ü—Ä–æ—Å—Ç–æ–π —á–∞—Ç', headerShown: true }}
        />
        <Stack.Screen 
          name="Chat" 
          component={ChatScreen}
          options={({ route }) => ({ 
            title: `–û–±—â–∏–π —á–∞—Ç - ${route.params?.username || '–ì–æ—Å—Ç—å'}`,
            headerLeft: null,
          })}
        />
      </Stack.Navigator>
    </NavigationContainer>
  );
}
```

### üñ•Ô∏è server.js - Backend —Å–µ—Ä–≤–µ—Ä
```javascript
const express = require('express');
const http = require('http');
const socketIo = require('socket.io');
const cors = require('cors');

const app = express();
const server = http.createServer(app);
const io = socketIo(server, {
  cors: { origin: "*", methods: ["GET", "POST"] }
});

app.use(cors());
app.use(express.json());

let messages = [];
let activeUsers = [];

app.get('/', (req, res) => {
  res.json({ 
    message: '–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!',
    users: activeUsers.length,
    messages: messages.length 
  });
});

io.on('connection', (socket) => {
  console.log(`üë§ –ü–æ–¥–∫–ª—é—á–∏–ª—Å—è: ${socket.id}`);
  socket.emit('messageHistory', messages);
  
  socket.on('userJoin', (username) => {
    socket.username = username;
    activeUsers.push({ id: socket.id, username });
    io.emit('userJoined', { username, userCount: activeUsers.length });
  });
  
  socket.on('sendMessage', (data) => {
    const message = {
      id: Date.now(),
      username: data.username,
      text: data.text,
      time: new Date().toLocaleTimeString('ru-RU', {
        hour: '2-digit', minute: '2-digit' 
      })
    };
    messages.push(message);
    io.emit('newMessage', message);
  });
  
  socket.on('disconnect', () => {
    if (socket.username) {
      activeUsers = activeUsers.filter(user => user.id !== socket.id);
      io.emit('userLeft', { username: socket.username, userCount: activeUsers.length });
    }
  });
});

const PORT = process.env.PORT || 3000;
server.listen(PORT, () => {
  console.log(`üöÄ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É ${PORT}`);
});
```

### üîê LoginScreen.js - –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞
```javascript
import React, { useState } from 'react';
import { View, Text, TextInput, TouchableOpacity, StyleSheet, Alert } from 'react-native';

export default function LoginScreen({ navigation }) {
  const [username, setUsername] = useState('');

  const handleJoinChat = () => {
    if (username.trim().length < 2) {
      Alert.alert('–û—à–∏–±–∫–∞', '–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞');
      return;
    }
    navigation.navigate('Chat', { username: username.trim() });
  };

  return (
    <View style={styles.container}>
      <Text style={styles.title}>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</Text>
      <Text style={styles.subtitle}>–ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?</Text>
      
      <TextInput
        style={styles.input}
        placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è..."
        value={username}
        onChangeText={setUsername}
        maxLength={20}
      />
      
      <TouchableOpacity 
        style={[styles.button, username.trim().length < 2 && styles.buttonDisabled]}
        onPress={handleJoinChat}
        disabled={username.trim().length < 2}
      >
        <Text style={styles.buttonText}>–í–æ–π—Ç–∏ –≤ —á–∞—Ç</Text>
      </TouchableOpacity>
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, backgroundColor: '#f5f5f5', justifyContent: 'center', padding: 20 },
  title: { fontSize: 28, fontWeight: 'bold', color: '#2196F3', textAlign: 'center', marginBottom: 10 },
  subtitle: { fontSize: 18, color: '#666', textAlign: 'center', marginBottom: 30 },
  input: { height: 50, borderWidth: 2, borderColor: '#ddd', borderRadius: 25, paddingHorizontal: 20, fontSize: 16, backgroundColor: '#fff', marginBottom: 20 },
  button: { height: 50, backgroundColor: '#2196F3', borderRadius: 25, justifyContent: 'center', alignItems: 'center' },
  buttonDisabled: { backgroundColor: '#ccc' },
  buttonText: { color: '#fff', fontSize: 18, fontWeight: 'bold' },
});
```

---

## üöÄ –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ó–ê–ü–£–°–ö–ê

### Backend —Å–µ—Ä–≤–µ—Ä:
```bash
cd backend
npm install
npm start
```

### Mobile –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```bash
cd mobile  
npm install
npx expo start
```

### –û–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:
```bash
# Terminal 1: Backend
cd backend && npm start

# Terminal 2: Mobile
cd mobile && npx expo start
```

---

## üìã PACKAGE.JSON –§–ê–ô–õ–´

### Backend dependencies:
```json
{
  "name": "backend",
  "scripts": { "start": "node server.js" },
  "dependencies": {
    "express": "^5.1.0",
    "socket.io": "^4.8.1",
    "cors": "^2.8.5"
  }
}
```

### Mobile dependencies:
```json
{
  "name": "mobile",
  "scripts": { "start": "expo start" },
  "dependencies": {
    "expo": "~54.0.10",
    "react": "19.1.0",
    "react-native": "0.81.4",
    "@react-navigation/native": "^7.1.17",
    "@react-navigation/stack": "^7.4.8",
    "socket.io-client": "^4.8.1"
  }
}
```

---

## üåê –¢–ï–°–¢–û–í–´–ï –°–°–´–õ–ö–ò

- **Backend API:** http://localhost:3000
- **Mobile App:** http://localhost:8081  
- **QR –∫–æ–¥:** –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ Expo –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ

---

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

```
simple-messenger/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ server.js ‚Üê Backend –∫–æ–¥
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ mobile/
‚îÇ   ‚îú‚îÄ‚îÄ App.js ‚Üê –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ screens/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoginScreen.js ‚Üê –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ChatScreen.js ‚Üê –≠–∫—Ä–∞–Ω —á–∞—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

---

## ‚úÖ –ì–û–¢–û–í–´–ï –§–£–ù–ö–¶–ò–ò

- ‚úÖ –í–≤–æ–¥ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ Real-time —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π  
- ‚úÖ –°—á–µ—Ç—á–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞
- ‚úÖ –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- ‚úÖ Web –≤–µ—Ä—Å–∏—è

---

*–í–µ—Å—å –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ*

### üí¨ ChatScreen.js - –≠–∫—Ä–∞–Ω —á–∞—Ç–∞
```javascript
import React, { useState, useEffect, useRef } from 'react';
import {
  View,
  Text,
  TextInput,
  TouchableOpacity,
  FlatList,
  StyleSheet,
  KeyboardAvoidingView,
  Platform,
  Alert,
} from 'react-native';
import io from 'socket.io-client';

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
const getServerUrl = () => {
  // –î–ª—è –≤–µ–±-–≤–µ—Ä—Å–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º localhost –∏–ª–∏ –ø—É–±–ª–∏—á–Ω—ã–π URL
  if (typeof window !== 'undefined' && window.location) {
    if (window.location.hostname === 'localhost') {
      return 'http://localhost:3001';
    } else if (window.location.hostname.includes('serveo.net')) {
      return 'https://8f2b1687d1e0567a6b3ac5ad45ecbc5a.serveo.net'; // –ù–æ–≤—ã–π serveo backend
    }
    return `http://${window.location.hostname}:3001`;
  }
  // –î–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π serveo URL
  return 'https://8f2b1687d1e0567a6b3ac5ad45ecbc5a.serveo.net';
};

const SERVER_URL = getServerUrl();

export default function ChatScreen({ route }) {
  const { username } = route.params;
  const [messages, setMessages] = useState([]);
  const [messageText, setMessageText] = useState('');
  const [userCount, setUserCount] = useState(0);
  const [isConnected, setIsConnected] = useState(false);
  
  const socketRef = useRef(null);
  const flatListRef = useRef(null);

  useEffect(() => {
    // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
    socketRef.current = io(SERVER_URL);
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    socketRef.current.on('connect', () => {
      console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω –∫ —Å–µ—Ä–≤–µ—Ä—É');
      setIsConnected(true);
      
      // –°–æ–æ–±—â–∞–µ–º —Å–µ—Ä–≤–µ—Ä—É –æ –≤—Ö–æ–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      socketRef.current.emit('userJoin', username);
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è
    socketRef.current.on('disconnect', () => {
      console.log('–û—Ç–∫–ª—é—á–µ–Ω –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
      setIsConnected(false);
    });

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
    socketRef.current.on('messageHistory', (history) => {
      setMessages(history);
    });

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    socketRef.current.on('newMessage', (message) => {
      setMessages(prev => [...prev, message]);
    });

    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
    socketRef.current.on('userJoined', (data) => {
      setUserCount(data.userCount);
    });

    socketRef.current.on('userLeft', (data) => {
      setUserCount(data.userCount);
    });

    socketRef.current.on('joinSuccess', (data) => {
      setUserCount(data.userCount);
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
    socketRef.current.on('error', (error) => {
      console.error('–û—à–∏–±–∫–∞ Socket.io:', error);
      Alert.alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', '–ù–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
    });

    // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
    return () => {
      if (socketRef.current) {
        socketRef.current.disconnect();
      }
    };
  }, [username]);

  // –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
  useEffect(() => {
    if (messages.length > 0 && flatListRef.current) {
```
